<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trail Search & Discovery - TrekSafe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Light background */
            color: #254d23; /* Dark green text */
        }
        .navbar {
            background-color: #254d23; /* Dark green for header */
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar-brand, .nav-link {
            color: #e0f2e0 !important; /* Lighter green for text */
            font-weight: 500;
        }
        .navbar-brand:hover, .nav-link:hover {
            color: #ffffff !important;
        }
        .btn-primary-trek {
            background-color: #228B22; /* Trekking green */
            border-color: #228B22;
            color: #fff;
            border-radius: 0.75rem; /* Rounded corners */
            padding: 0.6rem 1.5rem;
            transition: background-color 0.2s ease;
        }
        .btn-primary-trek:hover {
            background-color: #176d1a; /* Darker green on hover */
            border-color: #176d1a;
        }
        .form-control:focus {
            border-color: #228B22;
            box-shadow: 0 0 0 0.25rem rgba(34,139,34,0.25);
        }
        .card {
            border-radius: 1rem; /* More rounded cards */
            border: none;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
        }
        .card:hover {
            transform: translateY(-5px); /* Subtle lift on hover */
        }
        .card-title {
            color: #254d23;
            font-weight: 600;
        }
        .card-text {
            color: #555;
        }
        .badge-difficulty-easy { background-color: #28a745; color: #fff; border-radius: 0.5rem; }
        .badge-difficulty-moderate { background-color: #ffc107; color: #333; border-radius: 0.5rem; }
        .badge-difficulty-difficult { background-color: #dc3545; color: #fff; border-radius: 0.5rem; }
        .footer {
            background-color: #254d23;
            color: #e0f2e0;
            padding: 1.5rem 0;
            text-align: center;
            margin-top: 3rem;
        }
        .form-check-input:checked {
            background-color: #228B22;
            border-color: #228B22;
        }
        .dropdown-menu {
            border-radius: 0.75rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .dropdown-item:active {
            background-color: #228B22;
            color: #fff;
        }
        /* Loading indicator styles */
        .loading-indicator {
            display: none;
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
            color: #228B22;
        }
        /* --- Specific styles for Search & Filter section enhancement --- */
        .search-filter-card .input-group {
            border: 1px solid #ddd;
            border-radius: 0.75rem; /* Match button radius */
            overflow: hidden; /* Ensures contents stay within rounded border */
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* Subtle shadow for the input group */
        }
        .search-filter-card .input-group .form-control {
            border: none; /* Remove individual input border */
        }
        .search-filter-card .input-group .input-group-text {
            background-color: #fff;
            border-right: none; /* Remove border between icon and input */
        }
        .search-filter-card .btn-primary-trek {
            border-radius: 0.75rem; /* Ensure button itself is rounded */
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        .filter-options-group {
            border-top: 1px solid #eee; /* Light separator */
            padding-top: 1.5rem;
            margin-top: 1.5rem; /* Space from search bar */
        }
        .form-select.rounded-pill, .form-control.rounded-pill {
            border-radius: 999px !important; /* Ensure full pill shape for select/input */
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container-fluid px-md-5">
        <a class="navbar-brand fw-bold" href="dashboard.html">
            <i class="bi bi-compass-fill me-2"></i>TrekSafe Trails
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="searchsuggest.html"><i class="bi bi-search me-1"></i>Search Trails</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="plan_trek.html"><i class="bi bi-map me-1"></i>My Treks</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="sosinfo.html"><i class="bi bi-exclamation-triangle me-1"></i>SOS</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="blog.html"><i class="bi bi-book me-1"></i>Safety Hub</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="profile.html"><i class="bi bi-person-circle me-1"></i>Profile</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<main class="container py-5">
    <h1 class="text-center mb-4 fw-bold">Discover Your Next Adventure</h1>
    <p class="text-center mb-5 text-muted">Find the perfect trail that matches your skill and spirit.</p>

    <!-- Search and Filter Section -->
    <div class="row justify-content-center mb-5">
        <div class="col-lg-10 col-md-11">
            <div class="card p-4 search-filter-card"> <!-- Added new class for specific styling -->
                <div class="input-group input-group-lg mb-4">
                    <span class="input-group-text bg-white border-0"><i class="bi bi-search fs-4 text-muted"></i></span>
                    <input type="text" class="form-control border-0 ps-0" placeholder="Search by keywords, location, or trail name..." id="trailSearchInput">
                    <button class="btn btn-primary-trek" type="button" id="searchButton">Search Trails</button>
                </div>

                <!-- Filters - Collapsible -->
                <div class="d-grid mb-4">
                    <button class="btn btn-outline-secondary d-md-none rounded-pill" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse" aria-expanded="false" aria-controls="filterCollapse">
                        <i class="bi bi-funnel me-2"></i>Show Filters
                    </button>
                </div>

                <div class="collapse d-md-block" id="filterCollapse">
                    <div class="filter-options-group"> <!-- Added new class for filter group styling -->
                        <div class="row g-3">
                            <!-- Difficulty Filter -->
                            <div class="col-md-4">
                                <label for="difficultyFilter" class="form-label fw-bold">Difficulty:</label>
                                <select class="form-select rounded-pill" id="difficultyFilter">
                                    <option selected value="">Any Difficulty</option>
                                    <option value="easy">Easy</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="difficult">Difficult</option>
                                </select>
                            </div>

                            <!-- Location Filter -->
                            <div class="col-md-4">
                                <label for="locationFilter" class="form-label fw-bold">Location:</label>
                                <input type="text" class="form-control rounded-pill" id="locationFilter" placeholder="e.g., Himalayas, Sahyadris">
                            </div>

                            <!-- Duration Filter -->
                            <div class="col-md-4">
                                <label for="durationFilter" class="form-label fw-bold">Duration:</label>
                                <select class="form-select rounded-pill" id="durationFilter">
                                    <option selected value="">Any Duration</option>
                                    <option value="half-day">Half Day (<4 hrs)</option>
                                    <option value="full-day">Full Day (4-8 hrs)</option>
                                    <option value="multi-day">Multi-day (>8 hrs)</option>
                                </select>
                            </div>

                            <!-- Optional: More filters could go here in more rows if needed -->
                        </div>
                        <div class="d-flex justify-content-end mt-4">
                            <button class="btn btn-outline-secondary me-2 rounded-pill" type="button" id="clearFilters">Clear Filters</button>
                            <button class="btn btn-primary-trek rounded-pill" type="button" id="applyFilters">Apply Filters</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Suggestions / Featured Trails Section -->
    <h2 class="mb-4 fw-bold text-center">Featured & Suggested Trails</h2>

    <!-- Loading Indicator -->
    <div class="loading-indicator" id="loadingIndicator">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading trails...</p>
    </div>

    <div id="trailResults" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <!-- Trail Cards will be dynamically loaded here by JavaScript -->
    </div>
</main>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <p class="mb-0">&copy; 2025 TrekSafe Trails. All rights reserved.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('trailSearchInput');
        const searchButton = document.getElementById('searchButton');
        const difficultyFilter = document.getElementById('difficultyFilter');
        const locationFilter = document.getElementById('locationFilter');
        const durationFilter = document.getElementById('durationFilter');
        const applyFiltersButton = document.getElementById('applyFilters');
        const clearFiltersButton = document.getElementById('clearFilters');
        const trailResultsContainer = document.getElementById('trailResults');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Dummy data for demonstration. In a real app, this would come from your Spring Boot backend.
        const allTrails = [
            { id: 'gv001', name: 'Green Valley Loop', location: 'Pune, Maharashtra', difficulty: 'easy', duration: 'half-day', rating: 4.5, reviews: 120, image: 'https://placehold.co/400x250/C1D8C1/254D23?text=Green+Valley', description: 'A serene loop through lush forests.', equipment: ['Water Bottle', 'Snacks'], safetyTips: ['Stay on path', 'Beware of slippery areas'] },
            { id: 'tl002', name: 'Tiger\'s Leap Ascent', location: 'Lonavala, Maharashtra', difficulty: 'moderate', duration: 'full-day', rating: 4.2, reviews: 85, image: 'https://placehold.co/400x250/D2E8E4/154157?text=Tiger%27s+Leap', description: 'Challenging climb with rewarding views.', equipment: ['Sturdy Boots', 'First Aid Kit'], safetyTips: ['Monitor weather', 'Use proper footwear'] },
            { id: 'kp003', name: 'Kalsubai Peak Traverse', location: 'Igatpuri, Maharashtra', difficulty: 'difficult', duration: 'multi-day', rating: 4.8, reviews: 210, image: 'https://placehold.co/400x250/C8D8ED/002B47?text=Kalsubai+Peak', description: 'Highest peak of Maharashtra, panoramic views.', equipment: ['Rope', 'Helmet', 'Gloves'], safetyTips: ['Trek with guide', 'Carry emergency beacon'] },
            { id: 'rf004', name: 'Rajgad Fort Trek', location: 'Pune, Maharashtra', difficulty: 'moderate', duration: 'full-day', rating: 4.7, reviews: 150, image: 'https://placehold.co/400x250/D1D8C1/254D23?text=Rajgad+Fort', description: 'Historical fort trek with steep ascents.', equipment: ['Torch', 'Power Bank'], safetyTips: ['Start early', 'Conserve energy'] },
            { id: 'lf005', name: 'Lohagad Fort Trail', location: 'Lonavala, Maharashtra', difficulty: 'easy', duration: 'half-day', rating: 4.0, reviews: 90, image: 'https://placehold.co/400x250/C1E8D1/154157?text=Lohagad+Fort', description: 'Easy access fort, popular for beginners.', equipment: ['Comfortable Shoes'], safetyTips: ['Stay hydrated'] },
            { id: 'ht006', name: 'Harishchandragad Trek', location: 'Ahmednagar, Maharashtra', difficulty: 'difficult', duration: 'multi-day', rating: 4.9, reviews: 300, image: 'https://placehold.co/400x250/E8D1C1/002B47?text=Harishchandragad', description: 'Ancient fort with a famous Konkan Kada cliff.', equipment: ['Sleeping Bag', 'Cooking Gear'], safetyTips: ['Experienced trekkers only', 'Check route conditions'] },
        ];

        /**
         * Simulates fetching data from the backend.
         * In a real application, this would be a 'fetch' or 'axios' call to your Spring Boot API.
         * @param {Object} filters - Object containing search term and filter values.
         * @returns {Promise<Array>} A promise that resolves with the filtered trail data.
         */
        function fetchTrailsFromBackend(filters) {
            loadingIndicator.style.display = 'block'; // Show loading indicator
            trailResultsContainer.innerHTML = ''; // Clear existing results

            return new Promise(resolve => {
                setTimeout(() => { // Simulate network delay
                    let filteredTrails = allTrails.filter(trail => {
                        const searchTerm = filters.searchTerm ? filters.searchTerm.toLowerCase() : '';
                        const difficulty = filters.difficulty || '';
                        const location = filters.location ? filters.location.toLowerCase() : '';
                        const duration = filters.duration || '';

                        const matchesSearch = (searchTerm === '' ||
                            trail.name.toLowerCase().includes(searchTerm) ||
                            trail.location.toLowerCase().includes(searchTerm) ||
                            trail.description.toLowerCase().includes(searchTerm)); // Added description to search
                        const matchesDifficulty = (difficulty === '' || trail.difficulty === difficulty);
                        const matchesLocation = (location === '' || trail.location.toLowerCase().includes(location));
                        const matchesDuration = (duration === '' || trail.duration === duration);

                        return matchesSearch && matchesDifficulty && matchesLocation && matchesDuration;
                    });

                    // Simulate AI-driven recommendation logic here if needed,
                    // e.g., if no search term, return personalized suggestions
                    if (filters.searchTerm === '' && filters.difficulty === '' && filters.location === '' && filters.duration === '') {
                        // This is where AI-driven smart suggestions would be fetched from the backend
                        // For now, it defaults to allTrails as featured.
                    }

                    loadingIndicator.style.display = 'none'; // Hide loading indicator
                    resolve(filteredTrails);
                }, 700); // 700ms delay
            });
        }

        function renderTrails(trailsToRender) {
            if (trailsToRender.length === 0) {
                trailResultsContainer.innerHTML = '<div class="col-12 text-center text-muted py-5"><p class="lead mb-3"><i class="bi bi-x-circle fs-3 d-block mb-2"></i></p><p>No trails found matching your criteria.</p><p class="small">Try adjusting your filters or search terms.</p></div>';
                return;
            }

            trailsToRender.forEach(trail => {
                const difficultyClass = `badge-difficulty-${trail.difficulty}`;
                const trailCard = `
            <div class="col">
              <div class="card h-100">
                <img src="${trail.image}" onerror="this.onerror=null;this.src='https://placehold.co/400x250/C0C0C0/FFFFFF?text=No+Image';" class="card-img-top" alt="Trail Image" style="border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
                <div class="card-body">
                  <h5 class="card-title">${trail.name}</h5>
                  <p class="card-text text-muted mb-2">Location: ${trail.location}</p>
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <span class="badge ${difficultyClass}">${trail.difficulty.charAt(0).toUpperCase() + trail.difficulty.slice(1)}</span>
                    <span class="text-muted"><i class="bi bi-clock me-1"></i>${getDurationText(trail.duration)}</span>
                    <span class="text-muted"><i class="bi bi-star-fill text-warning me-1"></i>${trail.rating} (${trail.reviews} reviews)</span>
                  </div>
                  <a href="detail.html?trailId=${trail.id}" class="btn btn-primary-trek btn-sm w-100">View Details <i class="bi bi-arrow-right"></i></a>
                </div>
              </div>
            </div>
          `;
                trailResultsContainer.innerHTML += trailCard;
            });
        }

        function getDurationText(duration) {
            switch(duration) {
                case 'half-day': return 'Half Day (<4 hrs)';
                case 'full-day': return 'Full Day (4-8 hrs)';
                case 'multi-day': return 'Multi-day (>8 hrs)';
                default: return '';
            }
        }

        async function applyFiltersAndSearch() {
            const filters = {
                searchTerm: searchInput.value,
                difficulty: difficultyFilter.value,
                location: locationFilter.value,
                duration: durationFilter.value
            };
            const trails = await fetchTrailsFromBackend(filters);
            renderTrails(trails);
        }

        // Event Listeners
        searchButton.addEventListener('click', applyFiltersAndSearch);
        applyFiltersButton.addEventListener('click', applyFiltersAndSearch);
        clearFiltersButton.addEventListener('click', function() {
            searchInput.value = '';
            difficultyFilter.value = '';
            locationFilter.value = '';
            durationFilter.value = '';
            applyFiltersAndSearch(); // Re-render with all trails (featured/suggestions)
        });

        // Initial render of all trails (smart suggestions/featured)
        applyFiltersAndSearch(); // Call with empty filters to get initial suggestions
    });
</script>
</body>
</html>